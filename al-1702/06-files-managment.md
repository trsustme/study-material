# Работа с файлами в ОС Astra Linux

## Логическая структура файловой системы

Монтирование - процедура построения единого дерева из веток, расположенных на разных устройствах.

Ветки дерева могут находиться на локальных устройствах, съемных и сетевых.

`.so` - shared object - разделяемая библиотека

Длина имени файла до 255 символов, длина пути - до 4096.

## Структура файла

Компоненты файла:
- имя файла
- индексный дескриптор(inode) - метаданные файла и ссылки на блоки данных
- блоки данных(0 или более)

`stat filename` - выводит содержимое inode

`ls -i filename` - показывает номер индексного дескриптора и имя файла

`df -i` - показывает количество свободных и занятых индексных дескрипторов в файловой системе

## Типы файлов

### Регулярный файл

### Каталог

### Символическая ссылка

Символическая ссылка - файл, который указывает на файл.

Можно:
- символические ссылки могут указывать на файлы в другой файловой системе(другом смонтированном устройстве).
- создать символическую ссылку на каталог

Если удален файл, на который ссылается символическая ссылка, то возникает ситуация broken link.

Чтобы команда выполнялась на файле, надо указывать флаг: `-L`

`find /путь/к/директории -type l -lname */путь/к/файлу` - найти все символьные ссылки, указывающие на конкретный файл

### Жесткая ссылка

Жесткая ссылка - не специальный файл, а еще одно имя существующего файла.

При создании жесткой ссылки новый файл не создается, а добавляется запись в каталог атрибут файла - счетчик
ссылок(link counter) увеличивается на единицу.

При удалении файла, link counter уменьшается. Если link counter == 0, то файл считается удаленным.

Нельзя создать жесткую ссылку
- на файл, который находится в другой файловой системе, а можно только в рамках одного смонтированного устройства.
- с произвольным именем на каталог - для предотвращения цикличности.

`.` и `..` - жесткие ссылки.

### Файл устройств

Файл устройств - это пустой файл, используемый для взаимодействия с драйверами устройств(блочными и символьными).

В inode хранится номер драйвера(major number) и номер устройства(minor number).

- символьные устройства - вид файла устройств, обеспечивающий интерфейс доступа к устройству(реальному или
виртуальному) с возможностью посимвольного обмена информацией
- блочные устройства - вид файла устройств, обеспечивающий интерфейс доступа к устройству(реальному или
виртуальному) в виде файла в файловой системе с возможностью обмена информации блоками данных


### Локальные сокеты(UNIX Socket) и именованные каналы(Pipe)

UNIX Sockets и Named Pipes - файлы для межпроцессорного взаимодействия

- сокеты позволяют процессам обмениваться данными, как если бы это была сетевая связь, но локально, внутри одной машины
- именованные каналы позволяют одному процессу писать данные, а другому читать

## Стандарт иерархии ФС

`man hier` - получить информацию по иерархии каталогов

- / - корневой каталог
- /bin - основные утилиты пользователя(symlink на /usr/bin)
    - ls, cp, mv
- /boot - файлы для начальной загрузки системы
- /dev - файлы устройств, подключенные к системе - например, диски, терминалы
- /etc - общесистемные конфигурационные файлы, управляющие поведением системы и программ
- /home - домашние каталоги пользователей -
- /lib - системные библиотеки, которые необходимы для работы основных утилит в /bin и /sbin. ссылка на /usr/lib
- /media - точка монтирования для сменных носителей - USB, DVD
- /mnt - для временного монтирования файловых систем
- /opt - дополнительное программное обеспечение, которое не входит в стандартный набор системы
- /proc - псевдо ФС - информация об ядре, процессах и аппаратном обеспечении
- /root - домашний каталог пользователя root
- /run - данные, необходимые для работы системных демонов и процессов, таких как сокеты и файлы PID(идентификаторы процессов)
- /sbin - основные команды для администрирования(ссылка на /usr/sbin), системные бинарные файлы
- /srv - данные, которые обслуживаются системными сервисами, например веб-серверами
- /sys - псевдо ФС - содержит информацию об устройствах
- /tmp - временные файлы, очистка происходит при перезагрузке системы

### Иерархия ФС: /usr

/usr - вторичная иерархия программного обеспечения
/usr/bin - дополнительные программы для всех пользователей
/usr/include - заголовочные файлы
/usr/lib - дополнительные библиотеки, программное обеспечение(статическая часть)
/usr/local - третичная иерархия программного обеспечения
/usr/sbin - дополнительные системные программы администратора
/usr/share - архитектурно-независимые данные
/usr/src - исходные коды программного обеспечения

### Иерархия ФС: /var

/var - изменяемые файлы
/var/lib - данные, изменяемые программами в процессе работы
/var/lock - файлы блокировки
/var/log - журналы
/var/mail - почтовые ящики пользователей
/var/spool - очереди

## Команды создания файлов

`ln -s filename linkname` - создание символической ссылки
`cp -s filename linkname` - создание символической ссылки

`ln filename linkname` - создание жесткой ссылки

`mknod` - создание специального файла устройств

`mkfifo` - создание именованного канала

## Операции с файлами

Флаги команды cp:
- -a - копируется ветка каталогов с сохранением основных атрибутов файлов и каталогов(владелец, группа владельцев, права доступа)
- -r - рекурсивное копирование
- -s - создается символическая ссылка вместо копирования файла
- -d - если копируется символическая ссылка, то копируется она, а не файл

Флаги команды rm:
- -r удаление ветки каталогов вместе со всем содержимым
- -f подтверждение удаления не требуется

`file` - информация о характере содержимого файла

`which` - поиск программы по имени в каталогах, перечисленных в каталогах переменной PATH

`find каталог параметры поиска` - поиск файлов по атрибутам файлов
    - `-name` - поиск по имени
    - `-size` - поиск по размеру файла
    - `-user`, `-group` - поиск по владельцу и группе владельцев
    - `-perm` - поиск по правам доступа
    - `-mtime` - поиск по времени изменения файла
    - `-type` - поиск по типу файла
    - `-exec командная строка \;` - выполнение действий над найденными файлами


## Поиск файлов

`find ~ -mtime -1 -type f -ls` - находит файлы в домашнем каталоге и его подкаталогах, которые были изменены в течение последних 24 часов

`sudo find / -mount -size +50M -exec ls -lh {} \;` - находит все файлы в системе размером больше 50МБ и демонстрирует это

`sudo find / -name '*.old' -type f -ls` - найти все файлы в системе с суффиксом .old

`type find`, `which find` - находит каталог команды find
