# Требования к ПК для установки Astra Linux

Минимальные требования:
- аппаратная платформа - процессор с архитектурой x86-64(AMD,Intel)
- RAM - от 1 Гб
- объем свободного дискового пространства - от 16 Гб
- устройство для чтения носителей(USB, DVD)
- монитор

Перед установкой ОС, нужно:
- сделать резервную копью данных с диска
- выделить дисковое пространство

# Разметка диска

LVM - система управления логическими томами, позволяет гибко управлять разделами без необходимости переформатирования

Мастер разметки - используется в случае отсутствия особых вариантов установки системы и хранимых данных на жестком диске, он создает:
- раздел для EFI загрузчика(EFI - хранилище для загрзчиков UEFI) (~500 Мб)
- корневой раздел с файловой системой ext4
- область подкачки swap
- раздел для домашних каталогов с файловой системой ext4

Swap - пространство подкачки, которое используется чтобы освободить страницы оперативной памяти на пространство на жестком диске.
- RAM+swap=виртуальная память
- если планируется гибернация, то swap=RAM+1~2Гб
- для сервера swap=1~3Гб

В зависимости от назначения сервера или рабочей станции можно создать дополнительные разделы:
- /var - каталог, который содержит файлы, которые подвергаются наиболее частому изменению(кэши, логи)
- /srv - каталог для сервисных нужд, для общедоступных данных для какой-то конкретной службы, например, веб-сервера
- /usr - каталог для хранения исполняемых файлов, библиотек и файлов документаци(man)
- /boot - содержит статическую часть ядра и загрузчик(примечание: после загрузки системы они не используются)
- /home - каталог для каталогов пользователей(примечание: полезен, когда надо переустановить ОС, не уничтожая данные пользователя)

# Запись таблицы разделов на диск

После форматирования жестких дисков и установки базовой системы нужно выбрать ядро для установки ОС:
- generic - для обычного использования
- hardened - для высокозащищенных систем
- lowlatency - для высоконагруженных систем

# Настройка ОС в зависимости от лицензии

## Для уровня Базовый
- Запрет вывода меня загрузчика - не будет GRUB
- Запрет трассировки ptrace - отключение возможности трассировки и отладки выполнения кода
- Запрос пароля для sudo
- Запрет установки бита исполнения - блокирование обычным пользователям устанавливать право на исполнение файлов
- Запрет исполнения скриптов пользователей - блокирование использования интерпретаторов
- Запрет исполнения макросов пользователей(в стандартных приложениях)
- Запрет консоли - запрещает обычным пользователям выполнять вход в систему с консоли
- Системные ограничения ulimits - ограничения на использование ресурсов пользователями (макс. количество процессоров, макс. размер файла и т.д.)
- Запрет автонастройки сети - отключается автоматическая настройка сети в процессе установки
- Местное время для системных часов - включение режима интерпретации показаний аппаратных часов

## Для уровня Усиленный
- все функции Базового уровня
- Мандатный контроль целостности(по умолчанию выбран)
- Замкнутая программная среда
- Очистка освобождаемой внешней памяти

## Для уровня Максимальный
- все функции Усиленного
- Мандатное управление доступом(по умолчанию выбран)

# Установка загрузчика GRUB

GRUB рекомендуется устанавливать в основную загрузочную запись жесткого диска.

# Действия после установки системы

`sudo set-fs-ilev status -v` - проверить состояние МКЦ на файловой системе
`sudo set-fs-ilev enable` - установить высокую мандатную целостность на системные каталоги и файлы

Пользователь, созданный во время установки, входит в группу astra-admin и может выполнять любые команды и изменения в настройках через sudo.

## Подготовка к установке обновления

Проверить наличие свободного места на дисковых разделах:
`df -h`

Вычислить контрольную сумму iso-образа с обновлением и сравнить с данными из соответствующего бюллетеня:
`gostsum -d file.iso` или `gostsum  -d /dev/sr0`
`md5sum -b file.iso` или `md5sum  -b /dev/sr0`

Контрольные суммы находятся в официальном репозитории Astra Linux и в личном кабинете. Файлы `*.gost`, `*.md5`, `*.sig`.

## Установка обновления

`sudo astra-update -k -a образ_установочного_диска образ_обновления`

- -k - настраивает автоматическое монтирование образов установочного диска и обновления при загрузке системы и
добавляет в список репозиториев имена каталогов, в которые монтируются образы (/etc/apt/sources.list)

Для монтирования образа диска с обновлением:
`sudo mount -r имя_образа /mnt`

для размонтирования:
`sudo umount /mnt`

## После установки обновления

`sudo apt-get check`

В случае обнаружении проблем с разрешением зависимостей пакетов:
`sudo apt -f install`

# Процесс загрузки ОС

1) После подачи питания на материнскую плату стартует процессор, который выполняет код из
- ROM - read-only memory
- BIOS - basic input/output system
- UEFI - unified extensible firmware interface

2) Проводится проверка оборудования на работоспособность и наличия необходимых компонентов

3) Запускается GRUB, который загружает ядро Linux и передает ему управление

4) Ядро Linux:
    - самораспаковывается в память
    - формирует интерфейс системных вызовов, механизм формирования процессов
