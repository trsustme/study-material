# Создание сценариев bash

## Сценарий bash

- Командный интерпретатор - компьютерная программа, обеспечивающая базовые возможности управления компьютером
  посредством интерактивного ввода команд через интерфейс командной строки или последовательного исполнения файлов
  сценариев
- Сценарий/скрипт - это программа, написанная на языке командного интерпретатора

## Переменные

- Переменная - именованное значение, содержащее информацию, хранящуюся в оперативной памяти
- Предопределенные командным интерпретатором
    - `PATH`, `PWD`, `USER` и т.д.
- Позиционные параметры (используются в сценариях):
    - `$1`, `$2`, ... `${10}`
    - `./scenario arg1 arg2 arg3` - позиционные переменные `$1`, `$2`, `$3` получат значения arg1 arg2 arg3, соответственно
    - `$#` - содержит число агрументов
    - `$*` и `$@` содержит позиционные аргументы, разделенные пробелом:
        - `$*` - содержит все параметры, введённые в командной строке в виде единого слова
        - `$@` - содержит параметры, разбитые на отдельные слова. Эти параметры можно перебирать в циклах
- Специальные параметры командного интерпретатора - создаются при запуске bash и не меняются:
    - `$0` - имя запущенного сценария, в интерактивном режиме - имя `bash`
    - `$$` - PID текущего процесса
    - `$_` - последний аргумент предыдущей выполненной команды
    - `$?` - код возврата предыдущей выполненной команды
        - 0 - успешное завершение команды
        - не 0 (1,2,3 и т. д.) - завершено с ошибкой
        - после того как `$?` использовано, оно изменится, так как команда, использующая `$?` сама дает код возврата
- Определенные пользователем (с помощью `declare` и присваивания)
- Переменные окружения - это не переменные bash, при этом переменные окружения импортируются в переменные bash при
  запуске
- `env` - получить список предопределенных переменных вместе с экспортируемыми переменными
- `set` - получить список предопределенных переменных вместе с переменными командного интерпретатора и функциями
- `declare`, `export`, `readonly` - определенные пользователем переменные

## Ввод и вывод данных

- `read varname` - результат будет в переменной `$varname`
    ```bash
    echo Введите значение
    read var1
    ```
- `read` - результат будет сохранен в переменной `$REPLY`
- `HEREDOC` - встроенный документ: многострочные данные вводятся сразу с командной строки или из сценария
- `echo string` - печатает string в stdout, осуществляя перевод строки
- `echo -n string` - печатает string в stdout, не осуществляя после напечатанной строки перевода строк
- `printf` - печатает строку, отформатированную по шаблону

## Конструкция условного оператора if

```bash
if условие
    then
    ...
    else
    ...
fi
```

Логические операторы:
- `-а` - логическое И
    - `exp1 -а exp2` true, если оба выражения true
- `-о` - логическое ИЛИ
    - `exp1 -о ехр2` true, если хотя бы одно из выражений true

## Конструкция множественного выбора case

```bash
case слово in
    шаблон_ 1)
        команды 1;;
    шаблон_2 | шаблон_3)
        команды_2;;
    шаблон_n)
        команды_n;;
    *)
    команды_n+1;;
esac
```

## Конструкция цикла for и while

```bash
for параметр in слово1 слово2 .. словоN
    do
        команды
done
```

```bash
while условие
    do
        команды
done
```

## Функции

- Функция (подпрограмма) - программный код внутри программы (сценария), к которому можно обратиться из другого места
  программы (т. е. вызвать функцию)
- Функция имеет имя, принимает параметры, возвращает код возврата, который сохраняется в `$?`
- Функция не порождает дочернего процесса, в остальном похожа на сценарий в сценарии

```bash
function имя) { # словоfunction можно опустить
... команды}
```

- `return код_возврата` - выход из функции и возврат кода возврата

## Обработка ошибок и завершение

- `exit` - может использоваться для завершения работы сценария
