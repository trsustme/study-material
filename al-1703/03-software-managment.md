# Управление программным обеспечением

## Компоненты системы управления ПО

- Программные пакеты (бинарные и в исходных кодах)
- Менеджеры пакетов (dpkg, apt-команды, apt, aptitude, synaptic)
- База данных установленных пакетов (/var/lib/apt)
- Репозитории ПО (локальные, удаленные)

## Программные пакеты

- Правила именования пакетов: `имя_пакета-версия-архитектура.deb`
- Пакет - это архив файлов (утилита `аг`)
- Структура бинарного пакета `(ar t deb-файл`):
    - Данные (файлы) пакета (`data.tar.gz`)
    - Метаданные (описание, зависимости, скрипты) пакета (`control.tar.gz`)
    - Файл debian-binary (версия deb-файла)
    - Другие файлы (например, ЭЦП)

## Репозиторий ПО

Репозиторий содержит:
- данные (deb-файлы) - каталог `pool/`
- метаданные (описание репозитория и пакетов) - каталог `dists/`


Репозиторий состоит из компонентов (по типу лицензий):
- `main` - СПО
- `contrib` - СПО, но для его работы требуется проприетарное ПО
- `non-free` - проприетарное ПО

## Настройка доступа к репозиториям

- Местонахождение репозиториев описывается в файле `/etc/apt/sources.list`
- Формат записи, описывающий репозиторий: `deb uri_peno название_репо названия_веток`
    - Пример: `deb file:///repo_dir 1.7_x86-64 main contrib non-free`
    - (`deb` - бинарные пакеты, `deb-src` - пакеты в исходных кодах)
- Доступ к репозиторию через прокси: `/etc/apt/apt.conf.d/70debconf`
    - `Acquire::http::Proxy "http://имя_прокси: порт"`
    - прокси-сервер - это промежуточный сервер, выступающий посредником между пользователем и целевым ресурсом в интернете

## Репозитории и состав ПО Astra Linux 1.7

- Основной репозиторий (`main`)
    - основной состав дистрибутива, реализующий все функциональные возможности продукта и функции безопасности
    - сертифицированная часть ОС
    - размещается на установочном диске, доступен авторизованным пользователям по персональной ссылке в ЛК.
- Базовый репозиторий (`base`)
    - средства разработки + все пакеты установочного диска (репозитория main) + ПО, необходимое для сборки репозитория main
    - не сертифицируется
    - доступен авторизованным пользователям по персональной ссылке в ЛК
- Расширенный репозиторий (`extended`)
    - дополнительное ПО, которое может функционировать в среде Astra Linux
    - не сертифицируется и не дорабатывается для реализации функций безопасности
    - доступен авторизованным пользователям по персональной ссылке в ЛК
- Оперативные обновления безопасности - изменения основного репозитория (`update`)
    - кумулятивные изменения основного репозитория (main), соответствующие выпуску оперативного обновления
    - сертифицируются
    - размещаются в публичном доступе при выпуске бюллетеня безопасности
- Специальный компонент расширенного репозитория(`astra-ce`):
    - компонент astra-ce предоставляет пакеты для обеспечение максимальной совместимости со сторонним программным
      обеспечением, разработанным либо без использования Astra Linux, либо с использованием дополнительного ПО
    - позволяет пользователям Astra Linux устанавливать и эксплуатировать ПО, разработанное для других Linux-систем

## Менеджеры пакетов `apt-команды` и `apt`

Основные действия утилиты `apt`:
- `update` - обновление информации о пакетах - синхронизирует информацию о пакетах, хранимую в локальном кэше, с
  информацией из репозиториев
- `search` - поиск пакетов - осуществляет поиск пакетов согласно информации из локального кэша
- `install` - установка пакетов
- `remove`, `purge` - удаление пакетов
    - `remove` не удаляет измененные конфигурационные файлы
    - `purge` удаляет все файлы пакета
- `show` - информация о пакетах
- `upgrade` u `dist-upgrade` - обновление пакетов
    - `upgrade` только обновляет пакеты
    - `dist-upgrade` также удаляет ненужные

`apt -n search строка_поиска` - поиск по информации, содержащейся в имени пакета

## Менеджер пакетов dpkg

Установка и удаление deb-пакетов:
- `dpkg -і имя_deb-файла` - установка пакета
- `dpkg -r имя_пакета` - удаление пакета
- `dpkg -р имя_пакета` - удаление пакета и конфиг файлов

Информация об установленных пакетах:
- `dpkg -l` - список всех установленных пакетов
- `dpkg -s имя_пакета` - детальная информация о пакете
- `dpkg -L имя_пакета` - список файлов пакета
- `dpkg -S имя_файла` - принадлежность файла к пакету

## Другие менеджеры пакетов

- `aptitude` - утилита для работы с репозиториями, имеет менюобразный интерфейс, но может использоваться и в командной
  строке
- `synaptic` - графическая утилита для работы с репозиториями
- `rpm` - управление rpm-пакетами (применяются в ОС семейства Red Hat)

## Подключение стороннего репозитория

- При подключении стороннего репозитория должен быть установлен публичный ключ, которым подписаны пакеты данного
  репозитория
- Алгоритм установки публичного ключа:
    - Добавить репозиторий в `/etc/apt/sources.list`
    - Выполнить команду `apt update`
    - Если появится сообщение, что ключ не найден, то скачать ключ с публичного сервера и добавить ключ в хранилище
      ключей:
        - `gpg --keyserver keyserver.ubuntu.com --recv-keys идентификатор_ключа`
        - `gpg -a --export идентификатор_ключа | apt-key add -`

## Создание собственного репозитория

- Для создания репозитория предназначена утилита `reprepro` (`sudo apt install reprepro`)
- Алгоритм создания репозитория:
    - Создать каталог, в котором будет создан репозиторий
    - В подкаталоге `conf` создать конфигурационный файл `distributions`
    - Создать ключ для репозитория
    - Создать структуру репозитория (информация из `distributions`)
        - `sudo reprepro --ask-passphrase -b имя_каталога export`
    - Поместить deb-пакет в репозиторий
        - `sudo reprepro --ask-passphrase -b имя_каталога -С имя_компоненты includedeb кодовое_имя_репо имя_пакета`

## Подключение собственного репозитория

- На сервере с репозиторием экспортировать публичный ключ репозитория в файл
    - `sudo gpg -a --output имя_файла --export реальное_имя`
- Скопировать ключ на компьютер, на котором будет подключаться репозиторий
- Добавить публичный ключ в хранилище ключей `apt`
    - `sudo apt-key add имя_файла`
- В файл `/etc/apt/sources.list` добавить строку `deb uri_ peno кодовое_имя_репо main contrib non-free`
- Обновить кэш репозиториев `sudo apt update`


